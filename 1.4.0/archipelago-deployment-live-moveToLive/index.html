
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project documentation for Archipelago.">
      
      
        <meta name="author" content="The Digital Services Team at Metropolitan New York Library Council">
      
      
        <link rel="canonical" href="https://docs.archipelago.nyc/1.4.0/archipelago-deployment-live-moveToLive/">
      
      
        <link rel="prev" href="../archipelago-deployment-live-gitworkflow/">
      
      
        <link rel="next" href="../archipelago-deployment-live-UpgradeFrom1dot3/">
      
      
      <link rel="icon" href="../images/ArchipelagoLogo-favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Moving from archipelago-deployment to archipelago-deployment-live - Archipelago Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extras.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#moving-from-archipelago-deployment-to-archipelago-deployment-live" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Archipelago Documentation" class="md-header__button md-logo" aria-label="Archipelago Documentation" data-md-component="logo">
      
  <img src="../images/ArchipelagoLogo-DumplingFinal2024Web240pxPurpleWhiteText.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Archipelago Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Moving from archipelago-deployment to archipelago-deployment-live
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/esmero/archipelago-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    archipelago-documentation
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Archipelago Documentation" class="md-nav__button md-logo" aria-label="Archipelago Documentation" data-md-component="logo">
      
  <img src="../images/ArchipelagoLogo-DumplingFinal2024Web240pxPurpleWhiteText.png" alt="logo">

    </a>
    Archipelago Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/esmero/archipelago-documentation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    archipelago-documentation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archipelago 101
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archipelago 101
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../101_guides_list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Core Documentation Guides
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ourtake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago's Philosophy & Guiding Principles
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryfields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strawberryfields Forever
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadatainarchipelago/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata in Archipelago
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archifilepersistencestrategy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago's File Persistence Strategy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Services
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Instructions and Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Instructions and Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps & Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            DevOps & Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archipelago-Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            Archipelago-Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-osx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Archipelago Drupal 10 on OSX (macOS)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Archipelago Drupal 10 on Ubuntu 18.04 or 20.04
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Archipelago Drupal 10 on Windows 10/11
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-democontent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding Demo Archipelago Digital Objects (ADOs) to your Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-UpgradeDrupalD9toD10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Drupal 9 to Drupal 10 (1.1.0 to 1.3.0)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-upgradeFromD8ToD9.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-upgradeFromRC3.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading from 1.0.0-RC3 to 1.0.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sslsetup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Set Up SSL for Docker/Archipelago
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archipelago-Deployment-Live
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            Archipelago-Deployment-Live
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-gitworkflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Github Workflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Moving from archipelago-deployment to archipelago-deployment-live
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Moving from archipelago-deployment to archipelago-deployment-live
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-this-documentation-for" class="md-nav__link">
    <span class="md-ellipsis">
      What is this documentation for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-this-documentation-not-for" class="md-nav__link">
    <span class="md-ellipsis">
      What is this documentation not for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differences-between-both-deployments-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Differences between both deployments strategies.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commonalities-between-both-deployment-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Commonalities between both deployment strategies.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-the-new-repo-in-place" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the new repo in place
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backing-up" class="md-nav__link">
    <span class="md-ellipsis">
      Backing up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backing up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-directory-structures" class="md-nav__link">
    <span class="md-ellipsis">
      The directory structures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    <span class="md-ellipsis">
      The Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copying-the-data-into-the-new-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Copying the Data into the new Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Copying the Data into the new Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-web" class="md-nav__link">
    <span class="md-ellipsis">
      The Web
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copying-the-web-into-the-new-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Copying the Web into the new Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Copying the Web into the new Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1_2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-enviromentals-configurations-settings-and-docker" class="md-nav__link">
    <span class="md-ellipsis">
      SSL, Enviromentals, Configurations, Settings and Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutdown-the-old-one-start-the-new-one" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown the old one, start the new one
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-UpgradeFrom1dot3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Archipelago 1.3.0 to 1.4.0 (Drupal 10.1 to 10.2.x)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-search_solr_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Solr
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-UpgradeDrupalD9toD10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Drupal 9 to Drupal 10 (1.1.0 to 1.3.0)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-upgradeFromD8ToD9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-upgradeFromRC3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading from 1.0.0-RC3 to 1.0.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelago-deployment-live-updatingContainers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Docker Containers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utility_scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility Scripts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps Q&A
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            DevOps Q&A
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xdebug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging PHP in Archipelago
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generalqa_minio_logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Min.io Logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generalqa_smtp_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SMTP Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../generalqa_twig_modules_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twig Modules Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Site Administration & Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Site Administration & Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryfield-formatters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strawberryfield Formatters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../createdisplaymodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating Display Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webformsasinput/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Primer on Display Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iiif_server_settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IIIF Server Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archifilepersistencestrategy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago's File Persistence Strategy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6" >
        
          
          <label class="md-nav__link" for="__nav_3_2_6" id="__nav_3_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Strawberry Runners Background/Post-Processing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_6">
            <span class="md-nav__icon md-icon"></span>
            Strawberry Runners Background/Post-Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryrunners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strawberry Runners Post-Processing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryrunners_pager_ocr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pager and OCR Post-processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryrunners_webpage_text/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webpage Text Post-processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryrunners_wacz_binary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WACZ Binary Post-processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberryrunners_subtitle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subtitle Post-processor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_7" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7" id="__nav_3_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Search & Solr
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7">
            <span class="md-nav__icon md-icon"></span>
            Search & Solr
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../search_solr_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search and Solr Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strawberry_key_name_providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Strawberry Key Name Providers, Solr Field, and Facet Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../search_advanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../search-within-collection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search Within Collections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iiif-content-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IIIF Content Search
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fragaria/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fragaria Redirects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../embargo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Embargo & Access Restrictions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../open_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata API Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../experimental_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Experimental ML Tools
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Content and Metadata Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Content and Metadata Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../firstobject/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesting Your First Object
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Webforms in Archipelago
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            Webforms in Archipelago
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webforms in Archipelago
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webformsasinput/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Primer on Display Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modifyingfileextensionsinwebform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modifying allowable file extensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customwebformelements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago Custom Webform Elements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webformLoDfromCSV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Archipelago's Webform LoD from CSV attached to an ADO suggest
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Find and Replace
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            Find and Replace
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../find_and_replace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Batch Find and Replace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../find_and_replace_action_text/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text Based Find and Replace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../find_and_replace_action_webform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webform Find and Replace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../find_and_replace_action_json_patch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON Patch Find and Replace
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_3_4" id="__nav_3_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Twig Templates and Archipelago
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_4">
            <span class="md-nav__icon md-icon"></span>
            Twig Templates and Archipelago
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadatatwigs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twig Templates and Archipelago
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workingtwigs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Working With Twig in Archipelago (getting started with custom Twig templates)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../twig_recipe_cards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Twig Recipe Cards for Common Use Cases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata_display_preview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata Display Preview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metadata_display_usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata Display Usage
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archipelago Multi-Importer (AMI)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Archipelago Multi-Importer (AMI)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ami_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago Multi-Importer (AMI)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ami_spreadsheet_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spreadsheet Formatting Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../googleapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration for Google Sheets API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AMIviaSpreadsheets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingesting New Digital Objects and Collections using Spreadsheets or Google Sheets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ami_lod_rec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linked Data Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ami_update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMI Update Sets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../I7solrImporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using the Islandora 7 Solr Importer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Additional Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Additional Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../presentations_events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago Presentations & Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inthewild/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelagos in the Wild
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../archipelag-logo-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago Commons Logo Usage Guidelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing Code/Docs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Contributing Code/Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../giveortake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Archipelago Contribution Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_2" >
        
          
          <label class="md-nav__link" for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_2">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation_about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About This Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation_template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation_features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional Features
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../documentation_technical/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Technical Details
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Care & Coding + Fixing / Acknowledgments / License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-this-documentation-for" class="md-nav__link">
    <span class="md-ellipsis">
      What is this documentation for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-this-documentation-not-for" class="md-nav__link">
    <span class="md-ellipsis">
      What is this documentation not for?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#differences-between-both-deployments-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Differences between both deployments strategies.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commonalities-between-both-deployment-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Commonalities between both deployment strategies.
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-the-new-repo-in-place" class="md-nav__link">
    <span class="md-ellipsis">
      Getting the new repo in place
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#backing-up" class="md-nav__link">
    <span class="md-ellipsis">
      Backing up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Backing up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-directory-structures" class="md-nav__link">
    <span class="md-ellipsis">
      The directory structures
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data" class="md-nav__link">
    <span class="md-ellipsis">
      The Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copying-the-data-into-the-new-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Copying the Data into the new Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Copying the Data into the new Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3_1" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-web" class="md-nav__link">
    <span class="md-ellipsis">
      The Web
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#copying-the-web-into-the-new-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Copying the Web into the new Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Copying the Web into the new Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1_2" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl-enviromentals-configurations-settings-and-docker" class="md-nav__link">
    <span class="md-ellipsis">
      SSL, Enviromentals, Configurations, Settings and Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutdown-the-old-one-start-the-new-one" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown the old one, start the new one
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">Archipelago-deployment</span>
    
  
    
    
    
      <span class="md-tag">Archipelago-deployment-live</span>
    
  
</nav>


  
  


<h1 id="moving-from-archipelago-deployment-to-archipelago-deployment-live">Moving from <code>archipelago-deployment</code> to <code>archipelago-deployment-live</code></h1>
<h2 id="what-is-this-documentation-for">What is this documentation for?</h2>
<p>If you have been using/running/populating an instance with Archipelago Digital Objects that was set up using our simpler-to-deploy but harder-to-customize <a href="https://github.com/esmero/archipelago-deployment">archipelago-deployment</a> strategy and can't wait to move to this one—meant for a larger (and somehow easier to maintain and upgrade on the long run) instance—but (wait!) you do not want to ingest again, set up again, configure users, etc. (You already did that!), this is your documentation.</p>
<h2 id="what-is-this-documentation-not-for">What is this documentation not for?</h2>
<p>To install an <code>archipelago-deployment-live</code> from scratch or to keep (forever) syncing between the two deployment options in a quantum phase shifting eternum like a time crystal.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>An instance of Archipelago (working, tested) installed using <code>archipelago-deployment</code> as a basis.</li>
<li>Basic knowledge and instincts on how to run Terminal Commands, copy files, run <code>composer</code>, <code>drush</code>, Linux Permissions, and <code>git</code> of course.</li>
<li>Patience. You can't skip steps here. Also, Patience again since you may have stretched (good) your current instance to do way more than we thought it could.</li>
<li>Time to read the main Documentation of this Repo to have a basic knowledge of how this is deployed. Recommended even if you are not going to deploy one from scratch here.</li>
<li>For Shell Commands documented here please copy line by line—not the whole block.</li>
</ul>
<h2 id="differences-between-both-deployments-strategies">Differences between both deployments strategies.</h2>
<p>In a nutshell: <code>archipelago-deployment-live</code> uses a different folder structure moving configuration storage, data storage outside of your webroot, and allows a much finer control of your settings (safer) and Docker containers.
In a nutshell inside the first nutshell: <code>archipelago-deployment-live</code> also ignores more files so keeping customized versions, your own packages, your own settings around, and version controlled is much easier.
Lastly: <code>archipelago-deployment-live</code> makes more use of Cloud Services, e.g. so if you have been running <code>min.io</code> as local mounted storage you may now consider moving storage (files) to a cloud service like AWS S3.</p>
<h2 id="commonalities-between-both-deployment-strategies">Commonalities between both deployment strategies.</h2>
<p>In a nutshell: Since both run the same code and use the same Docker Containers, the data is actually the same. Everything is just persisted in different places.</p>
<h2 id="getting-the-new-repo-in-place">Getting the new repo in place</h2>
<p>First you need to clone this repository and (hopefully) store in the same parent folder to your current <code>archipelago-deployment</code> one. For the purpose of this tutorial we will assume you have <code>archipelago-deployment</code> cloned in this location: <code>$HOME/archipelago-deployment</code>.</p>
<p>Locate your <code>archipelago-deployment</code> folder in your terminal. Do an <code>ls</code> to make sure you can see the folder (not the content) and run:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/esmero/archipelago-deployment-live
<span class="nb">cd</span><span class="w"> </span>archipelago-deployment-live
git<span class="w"> </span>checkout<span class="w"> </span><span class="m">1</span>.0.0-RC3
<span class="nb">cd</span><span class="w"> </span>..
<span class="nb">cd</span><span class="w"> </span>archipelago-deployment
</code></pre></div>
<p>Now you have side by side <code>$HOME/archipelago_deployment</code> and <code>$HOME/archipelago-deployment-live</code>.</p>
<p>This will give you the base structure.</p>
<p>Before touching anything let's start by generating a backup of your current deployment (safety first).</p>
<h2 id="backing-up">Backing up</h2>
<h3 id="step-1">Step 1:</h3>
<p>Shut down your <code>docker-compose</code> ensemble. Inside your original <code>archipelago-deployment</code> folder run this:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>down
</code></pre></div>
<h3 id="step-2">Step 2:</h3>
<p>Verify all containers are actually down:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div>
<p>The following command should return an empty listing. If anything is still running, wait a little longer and run the previous command again.</p>
<h3 id="step-3">Step 3:</h3>
<p>Now let's tar.gz the whole ensemble with data and configs. As an example we will save this into your <code>$HOME</code> folder.
As a good practice we append the <strong>current date</strong> (YEAR-MONTH-DAY) to the filename. Here we assume today is December 1st of 2021:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>tar<span class="w"> </span>-czvpf<span class="w"> </span><span class="nv">$HOME</span>/archipelago-deployment-backup-20211201.tar.gz<span class="w"> </span>../archipelago-deployment
</code></pre></div>
<p>The process may take a few minutes. Now let's verify that all is there and that the <code>tar.gz</code> is not corrupt:</p>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-tvvf<span class="w"> </span><span class="nv">$HOME</span>/archipelago-deployment-backup-20211201.tar.gz<span class="w"> </span>
</code></pre></div>
<p>You will see a listing of files. If corrupt (do you have enough space? did your ssh connection drop?) you will see:</p>
<div class="highlight"><pre><span></span><code>tar:<span class="w"> </span>Unrecognized<span class="w"> </span>archive<span class="w"> </span>format
</code></pre></div>
<p>Done! If you are running a public instance we can allow ourselves to start Docker again to avoid downtime:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<h2 id="the-directory-structures">The directory structures</h2>
<p>Now that you backed all up we can spend some minutes looking at both directory structures.</p>
<p>If you observe both deployment strategies side by side you will inmediately notice the most important similarities and also differences:</p>
<table>
    <tr>
        <th>archipelago-deployment Live</th>
        <th>archipelago-deployment</th>
    </tr>
    <tr>
        <td valign="top"><pre>.
├── config_storage
│   ├── iiifconfig
│   ├── nginxconfig
│   ├── nginxconfig_selfcert
│   ├── php-fpm
│   └── solrconfig
├── data_storage
│   ├── db
│   ├── iiifcache
│   ├── iiiftmp
│   ├── letsencrypt
│   ├── minio-data
│   ├── ngnixcache
│   ├── selfcert
│   ├── solrcore
│   └── solrlib
├── deploy
│   ├── azure-kubernetes
│   ├── ec2-docker
│   └── kubernetes
├── docs
└── drupal
│   ├── config
│   ├── d8content
│   ├── docs
│   ├── drush
│   ├── patches
│   ├── persistent
│   ├── private
│   ├── scripts
│   ├── vendor
│   ├── web
│   └── xdebug
</pre></td>
        <td valign="top"><pre>.
├── config
│   └── sync
├── d8content
│   └── metadatadisplays
├── docs
├── drush
│   ├── Commands
│   └── sites
├── nginxconfigford8
├── patches
├── persistent
│   ├── db
│   ├── iiifcache
│   ├── iiifconfig
│   ├── miniodata
│   ├── solrconfig
│   ├── solrcore
│   └── solrlib
├── private
│   └── webform
├── scripts
│   ├── archipelago
│   └── composer
├── vendor
│   ├── archipelago
│   ├── asm89
│   ├── aws
│   ├── behat
│   ├── bin
│   ├── brick
│   ├── chi-teck
│   ├── composer
│   ├── consolidation
│   ├── container-interop
│   ├── cweagans
│   ├── data-values
│   ├── dflydev
│   ├── doctrine
│   ├── drupal
│   ├── drush
│   ├── easyrdf
│   ├── egulias
│   ├── enlightn
│   ├── erusev
│   ├── evenement
│   ├── ezyang
│   ├── fabpot
│   ├── fileeye
│   ├── firebase
│   ├── frictionlessdata
│   ├── google
│   ├── graham-campbell
│   ├── grasmash
│   ├── guzzlehttp
│   ├── instaclick
│   ├── jcalderonzumba
│   ├── jean85
│   ├── jmikola
│   ├── justinrainbow
│   ├── laminas
│   ├── league
│   ├── lsolesen
│   ├── maennchen
│   ├── markbaker
│   ├── masterminds
│   ├── mglaman
│   ├── mhor
│   ├── mikey179
│   ├── mixnode
│   ├── ml
│   ├── monolog
│   ├── mtdowling
│   ├── myclabs
│   ├── nesbot
│   ├── nette
│   ├── nikic
│   ├── paragonie
│   ├── pear
│   ├── phar-io
│   ├── phenx
│   ├── phpdocumentor
│   ├── phplang
│   ├── phpmailer
│   ├── phpoffice
│   ├── phpoption
│   ├── phpseclib
│   ├── phpspec
│   ├── phpstan
│   ├── phpunit
│   ├── professional-wiki
│   ├── psr
│   ├── psy
│   ├── ralouphie
│   ├── ramsey
│   ├── react
│   ├── sebastian
│   ├── seld
│   ├── sirbrillig
│   ├── solarium
│   ├── squizlabs
│   ├── stack
│   ├── strawberryfield
│   ├── swaggest
│   ├── symfony
│   ├── symfony-cmf
│   ├── theseer
│   ├── twbs
│   ├── twig
│   ├── typo3
│   ├── vlucas
│   ├── web64
│   ├── webflo
│   ├── webmozart
│   ├── wikibase
│   ├── wikimedia
│   └── zaporylie
├── web
│   ├── core
│   ├── libraries
│   ├── modules
│   ├── profiles
│   ├── sites
│   └── themes</pre></td>
    </tr>
</table>

<h2 id="the-data">The Data</h2>
<p>Let's start by focusing on the <code>data</code>, in our case the Database, Solr, and File (S3 + Private) storage. Collapsing here a few folders will make this easier to read.
Marked with a <code>*</code> are matching folders that contain DB, Solr Core, the S3 min.io data (if you are using local storage) and also Drupal's very own <code>private</code> folder:</p>
<table>
    <tr>
        <th>archipelago-deployment Live</th>
        <th>archipelago-deployment</th>
    </tr>
    <tr>
        <td valign="top"><pre>.
├── config_storage
├── data_storage
│   ├── * db *
│   ├── iiifcache
│   ├── iiiftmp
│   ├── letsencrypt
│   ├── * minio-data *
│   ├── ngnixcache
│   ├── selfcert
│   ├── solrcore
│   └── solrlib
├── deploy
├── docs
└── drupal
│   ├── config
│   ├── d8content
│   ├── docs
│   ├── drush
│   ├── patches
│   ├── persistent
│   ├── * private *
│   ├── scripts
│   ├── vendor
│   ├── web
│   └── xdebug
</pre></td>
        <td valign="top"><pre>.
├── config
├── d8content
├── docs
├── drush
├── nginxconfigford8
├── patches
├── persistent
│   ├── * db *
│   ├── iiifcache
│   ├── iiifconfig
│   ├── * miniodata *
│   ├── solrconfig
│   ├── * solrcore *
│   └── solrlib
├── * private *
├── scripts
├── vendor
├── web
</pre></td>
    </tr>
</table>

<h3 id="copying-the-data-into-the-new-structure">Copying the Data into the new Structure</h3>
<p>To do so we need to stop Docker again. This is needed because Databases sometimes keep an open Change Log and Locks in place, and if there is any interaction or cron running, your data may end up corrupted.</p>
<h4 id="step-1_1">Step 1:</h4>
<p>Shut down your <code>docker-compose</code> ensemble. Inside your original <code>archipelago-deployment</code> folder run this:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>down
</code></pre></div>
<h4 id="step-2_1">Step 2:</h4>
<p>Verify all containers are actually down:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div>
<h4 id="step-3_1">Step 3:</h4>
<p>We will copy DB, min.io (File and ADO storage as files) and Drupal's private (temporary files, caches) folders to its new place:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>persistent/db<span class="w"> </span>../archipelago-deployment-live/data_storage/db
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>persistent/solrcore<span class="w"> </span>../archipelago-deployment-live/data_storage/solrcore
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>persistent/miniodata<span class="w"> </span>../archipelago-deployment-live/data_storage/minio-data
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>private<span class="w"> </span>../archipelago-deployment-live/drupal/private
</code></pre></div>
<p>Running <code>-rpv</code> will copy verbosely and recursively while preserving original permissions.</p>
<p>Done!</p>
<p>You can now start <code>docker-compose</code> again:</p>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<h2 id="the-web">The Web</h2>
<p>Collapsing again a few folders to aid in readability, we can now focus on your actual Drupal/Archipelago Code/Web and settings. To be honest (we are), you can easily reinstall and restore all this via <code>composer</code>, but we can also move folders as a learning experience/time and bandwidth experience. Marked with a <code>*</code> are matching folders you want to copy over:</p>
<table>
    <tr>
        <th>archipelago-deployment Live</th>
        <th>archipelago-deployment</th>
    </tr>
    <tr>
        <td valign="top"><pre>.
├── config_storage
├── data_storage
├── deploy
├── docs
└── drupal
│   ├── * config *
│   ├── d8content
│   ├── docs
│   ├── drush
│   ├── patches
│   ├── persistent
│   ├── private
│   ├── scripts
│   ├── * vendor *
│   ├── * web *
│   └── xdebug
</pre></td>
        <td valign="top"><pre>.
├── * config *
│   └── sync
├── d8content
│   └── metadatadisplays
├── docs
├── drush
│   ├── Commands
│   └── sites
├── nginxconfigford8
├── patches
├── persistent
├── private
├── scripts
├── * vendor *
├── * web *
</pre></td>
    </tr>
</table>

<h3 id="copying-the-web-into-the-new-structure">Copying the Web into the new Structure</h3>
<p>No need to stop Docker again. We can do this while your Archipelago is still running.</p>
<h4 id="step-1_2">Step 1:</h4>
<p>We will copy all important folders over. From your <code>archipelago-deployment</code> folder run:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>vendor<span class="w"> </span>../archipelago-deployment-live/drupal/vendor
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>web<span class="w"> </span>../archipelago-deployment-live/drupal/web
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>config<span class="w"> </span>../archipelago-deployment-live/drupal/config
</code></pre></div>
<p>And also, selectively, a few files we know you are very fond of!</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>composer.json<span class="w"> </span>../archipelago-deployment-live/drupal/composer.json
sudo<span class="w"> </span>cp<span class="w"> </span>-rpv<span class="w"> </span>composer.lock<span class="w"> </span>../archipelago-deployment-live/drupal/composer.lock
</code></pre></div>
<p>Done!</p>
<h2 id="ssl-enviromentals-configurations-settings-and-docker">SSL, Enviromentals, Configurations, Settings and Docker</h2>
<p>We are almost done, but <code>archipelago-deployment-live</code> has a different, safer way of defining SSL Certs, credentials, and global settings for your Archipelago. 
We will start first by copying settings as they are (most likely not very safe), and then we can update passwords/etc. to make your system better-prepared for the world.</p>
<p>To learn more about these general settings please read <a href="../archipelago-deployment-live-readme/#step-3-setup-your-enviromental-variables-for-dockerservices">this section of the parent Documentation</a> (who likes duplicated documentation? Nobody.).
The gist here is (after reading, please do not skip) that we need to add our service definitions into a <code>.env</code> file.</p>
<p>Coming from <code>archipelago-deployment</code> means and assumes that you are running AWS Linux 2 using the suggested locations in this document, that you have a vanilla deployment, and that you followed <a href="https://github.com/esmero/archipelago-deployment/blob/1.0.0-RC2/archipelago-deployment-ubuntu.md">these instructions</a>) so your values for <code>$HOME/archipelago-deployment-live/deploy/ec2-docker/.env</code> will be the following:</p>
<div class="highlight"><pre><span></span><code><span class="nv">ARCHIPELAGO_ROOT</span><span class="o">=</span>/home/ec2-user/archipelago-deployment-live
<span class="nv">ARCHIPELAGO_EMAIL</span><span class="o">=</span>your@validemail.org
<span class="nv">ARCHIPELAGO_DOMAIN</span><span class="o">=</span>your.domain.org
<span class="nv">MINIO_ACCESS_KEY</span><span class="o">=</span>minio
<span class="nv">MINIO_SECRET_KEY</span><span class="o">=</span>minio123
<span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>esmero-db
<span class="nv">MINIO_BUCKET_MEDIA</span><span class="o">=</span>archipelago
<span class="nv">MINIO_FOLDER_PREFIX_MEDIA</span><span class="o">=</span>/
<span class="nv">MINIO_BUCKET_CACHE</span><span class="o">=</span>archipelago
<span class="nv">MINIO_FOLDER_PREFIX_CACHE</span><span class="o">=</span>/
</code></pre></div>
<p>If you plan on staying on local storage driven <code>min.io</code>, <code>MINIO_BUCKET_CACHE</code> and <code>MINIO_FOLDER_PREFIX_CACHE</code> are not going to be used. If you are planning on moving your Storage from local to cloud driven please replace with the right values, e.g. AWS IAM keys and Secrets + bucket names and prefixes (folders).
Again, refer to the <a href="../archipelago-deployment-live-readme/#step-3-setup-your-enviromental-variables-for-dockerservices">parent Documentation</a> for setting this up.</p>
<p>Once you have that in place (Double-check. If something goes wrong here we can always fine-tune and fix again.), we need to decide on a new <code>docker-compose</code> file, and you may need to customize it depending on your choices and current and future needs.</p>
<p>If you already have an SSL certificate, and it's provided by <code>CertBot</code> you can either copy the certs from your current system (will totally depend on your setup since <code>archipelago-deployment</code> does not provide out-of-the-box SSL Certs) to <code>$HOME/archipelago-deployment-live/data_storage/letsencrypt</code>.</p>
<p>A normal folder structure for that is:</p>
<div class="highlight"><pre><span></span><code>.
├──<span class="w"> </span>accounts
│<span class="w">   </span>└──<span class="w"> </span>acme-v02.api.letsencrypt.org
│<span class="w">       </span>└──<span class="w"> </span>directory
│<span class="w">           </span>└──<span class="w"> </span>cac9f8218ef18e4f11ec053785bbf648
│<span class="w">               </span>├──<span class="w"> </span>meta.json
│<span class="w">               </span>├──<span class="w"> </span>private_key.json
│<span class="w">               </span>└──<span class="w"> </span>regr.json
├──<span class="w"> </span>archive
│<span class="w">   </span>├──<span class="w"> </span>your.domain.org
│<span class="w">       </span>├──<span class="w"> </span>cert1.pem
│<span class="w">       </span>├──<span class="w"> </span>chain1.pem
│<span class="w">       </span>├──<span class="w"> </span>fullchain1.pem
│<span class="w">       </span>└──<span class="w"> </span>privkey1.pem
│<span class="w"> </span>
├──<span class="w"> </span>csr
│<span class="w">   </span>├──<span class="w"> </span>0000_csr-certbot.pem
│<span class="w">   </span>├──<span class="w"> </span>0001_csr-certbot.pem
│<span class="w">   </span>├──<span class="w"> </span>0002_csr-certbot.pem
│<span class="w">   </span>└──<span class="w"> </span>0003_csr-certbot.pem
├──<span class="w"> </span>keys
│<span class="w">   </span>├──<span class="w"> </span>0000_key-certbot.pem
│<span class="w">   </span>├──<span class="w"> </span>0001_key-certbot.pem
│<span class="w">   </span>├──<span class="w"> </span>0002_key-certbot.pem
│<span class="w">   </span>└──<span class="w"> </span>0003_key-certbot.pem
├──<span class="w"> </span>live
│<span class="w">   </span>├──<span class="w"> </span>README
│<span class="w">   </span>└──<span class="w"> </span>your.domain.org
│<span class="w">      </span>├──<span class="w"> </span>cert.pem<span class="w"> </span>-&gt;<span class="w"> </span>../../archive/your.domain.org/cert1.pem
│<span class="w">      </span>├──<span class="w"> </span>chain.pem<span class="w"> </span>-&gt;<span class="w"> </span>../../archive/your.domain.org/chain1.pem
│<span class="w">      </span>├──<span class="w"> </span>fullchain.pem<span class="w"> </span>-&gt;<span class="w"> </span>../../archive/your.domain.org/fullchain1.pem
│<span class="w">      </span>├──<span class="w"> </span>privkey.pem<span class="w"> </span>-&gt;<span class="w"> </span>../../archive/your.domain.org/privkey1.pem
│<span class="w">      </span>└──<span class="w"> </span>README
├──<span class="w"> </span>renewal
│<span class="w">   </span>└──<span class="w"> </span>your.domain.org.conf
│<span class="w">   </span>
└──<span class="w"> </span>renewal-hooks
<span class="w">    </span>├──<span class="w"> </span>deploy
<span class="w">    </span>├──<span class="w"> </span>post
<span class="w">    </span>└──<span class="w"> </span>pre
</code></pre></div>
<p>Or if your SSL cert is up for renewal, you can just let Archipelago request it for you. Renewal will happen auto-magically, and you may never ever need to worry about that in the future.</p>
<p>Finally, let's adapt the <code>docker-compose</code> file we need to our previous (but still current!) <code>archipelago-deployment</code> reality.</p>
<p>For x86/AMD, run (for ARM64/Apple M1 please check the <a href="../archipelago-deployment-live-readme/#deployment-on-arm64v8graviton-apple-m1-system">parent Documentation</a>):</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span><span class="nv">$home</span>/archipelago-deployment-live/deploy/ec2-docker/docker-compose-aws-s3.yml<span class="w"> </span><span class="nv">$home</span>/archipelago-deployment-live/deploy/ec2-docker/docker-compose.yml
nano<span class="w"> </span><span class="nv">$home</span>/archipelago-deployment-live/deploy/ec2-docker/docker-compose.yml
</code></pre></div>
<p>And replace the content with this slightly modified version. Note: we really only changed the lines after this comment: <code># THIS DIFFERS FROM THE NORMAL ONE...</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Run docker-compose up -d</span>

version:<span class="w"> </span><span class="s1">&#39;3.5&#39;</span>
services:
<span class="w">  </span>web:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-web
<span class="w">    </span>image:<span class="w"> </span>staticfloat/nginx-certbot
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>environment:
<span class="w">      </span>CERTBOT_EMAIL:<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_EMAIL</span><span class="si">}</span>
<span class="w">      </span>ENVSUBST_VARS:<span class="w"> </span>FQDN
<span class="w">      </span>FQDN:<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_DOMAIN</span><span class="si">}</span>
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;80:80&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;443:443&quot;</span>
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/config_storage/nginxconfig/conf.d:/etc/nginx/user.conf.d
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/config_storage/nginxconfig/certbot_extra_domains:/etc/nginx/certbot/extra_domains:ro
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/drupal:/var/www/html:cached
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/ngnixcache:/var/cache/nginx
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/letsencrypt:/etc/letsencrypt
<span class="w">    </span>depends_on:
<span class="w">      </span>-<span class="w"> </span>solr
<span class="w">      </span>-<span class="w"> </span>php
<span class="w">      </span>-<span class="w"> </span>db
<span class="w">    </span>tty:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">  </span>php:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-php
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>image:<span class="w"> </span><span class="s2">&quot;esmero/php-7.4-fpm:1.0.0-RC2-multiarch&quot;</span>
<span class="w">    </span>tty:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/config_storage/php-fpm/www.conf:/usr/local/etc/php-fpm.d/www.conf
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/drupal:/var/www/html:cached
<span class="w">    </span>environment:
<span class="w">      </span>MINIO_ACCESS_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_ACCESS_KEY</span><span class="si">}</span>
<span class="w">      </span>MINIO_SECRET_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_SECRET_KEY</span><span class="si">}</span>
<span class="w">      </span>MYSQL_ROOT_PASSWORD:<span class="w"> </span><span class="si">${</span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="si">}</span>
<span class="w">      </span>MINIO_BUCKET_MEDIA:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_BUCKET_MEDIA</span><span class="si">}</span>
<span class="w">      </span>MINIO_FOLDER_PREFIX_MEDIA:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_FOLDER_PREFIX_MEDIA</span><span class="si">}</span>
<span class="w">  </span>solr:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-solr
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>image:<span class="w"> </span><span class="s2">&quot;solr:8.8.2&quot;</span>
<span class="w">    </span>tty:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;8983:8983&quot;</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/solrcore:/var/solr/data
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/config_storage/solrconfig:/drupalconfig
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/solrlib:/opt/solr/contrib/archipelago/lib
<span class="w">    </span>entrypoint:
<span class="w">      </span>-<span class="w"> </span>docker-entrypoint.sh
<span class="w">      </span>-<span class="w"> </span>solr-precreate
<span class="w">      </span>-<span class="w"> </span>drupal
<span class="w">      </span>-<span class="w"> </span>/drupalconfig
<span class="w">  </span>db:
<span class="w">    </span>image:<span class="w"> </span>mysql:8.0.22
<span class="w">    </span>command:<span class="w"> </span>mysqld<span class="w"> </span>--default-authentication-plugin<span class="o">=</span>mysql_native_password<span class="w">  </span>--max_allowed_packet<span class="o">=</span>256M
<span class="w">    </span>container_name:<span class="w"> </span>esmero-db
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>environment:
<span class="w">      </span>MYSQL_ROOT_PASSWORD:<span class="w"> </span><span class="si">${</span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="si">}</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/db:/var/lib/mysql
<span class="w">  </span>nlp:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-nlp
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>image:<span class="w"> </span><span class="s2">&quot;esmero/esmero-nlp:1.0&quot;</span>
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;6400:6400&quot;</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">  </span>iiif:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-cantaloupe
<span class="w">    </span>image:<span class="w"> </span><span class="s2">&quot;esmero/cantaloupe-s3:4.1.9RC&quot;</span>
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;8183:8182&quot;</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">    </span>environment:
<span class="w">      </span>AWS_ACCESS_KEY_ID:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_ACCESS_KEY</span><span class="si">}</span>
<span class="w">      </span>AWS_SECRET_ACCESS_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_SECRET_KEY</span><span class="si">}</span>
<span class="w">      </span><span class="c1"># THIS DIFFERS FROM THE STANDARD ONE AND ENABLES LOCAL FILESYSTEM CACHE INSTEAD OF AWS S3 one</span>
<span class="w">      </span>CACHE_SERVER_DERIVATIVE:<span class="w"> </span>FilesystemCache
<span class="w">      </span>S3SOURCE_BASICLOOKUPSTRATEGY_BUCKET_NAME:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_BUCKET_MEDIA</span><span class="si">}</span>
<span class="w">      </span>S3SOURCE_BASICLOOKUPSTRATEGY_PATH_PREFIX:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_FOLDER_PREFIX_MEDIA</span><span class="si">}</span>
<span class="w">      </span>S3CACHE_BUCKET_NAME:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_BUCKET_CACHE</span><span class="si">}</span><span class="w"> </span>
<span class="w">      </span>S3CACHE_OBJECT_KEY_PREFIX:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_FOLDER_PREFIX_CACHE</span><span class="si">}</span><span class="w"> </span>
<span class="w">      </span>XMS:<span class="w"> </span>2g
<span class="w">      </span>XMX:<span class="w"> </span>4g
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/config_storage/iiifconfig:/etc/cantaloupe
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/iiifcache:/var/cache/cantaloupe
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/iiiftmp:/var/cache/cantaloupe_tmp
<span class="w">  </span>minio:
<span class="w">    </span>container_name:<span class="w"> </span>esmero-minio
<span class="w">    </span>restart:<span class="w"> </span>always
<span class="w">    </span>image:<span class="w"> </span>minio/minio:latest
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span><span class="si">${</span><span class="nv">ARCHIPELAGO_ROOT</span><span class="si">}</span>/data_storage/minio-data:/data:cached
<span class="w">    </span>ports:
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;9000:9000&quot;</span>
<span class="w">      </span>-<span class="w"> </span><span class="s2">&quot;9001:9001&quot;</span>
<span class="w">    </span>networks:
<span class="w">      </span>-<span class="w"> </span>host-net
<span class="w">      </span>-<span class="w"> </span>esmero-net
<span class="w">    </span>environment:
<span class="w">      </span>MINIO_HTTP_TRACE:<span class="w"> </span>/tmp/minio-log.txt
<span class="w">      </span>MINIO_ROOT_USER:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_ACCESS_KEY</span><span class="si">}</span>
<span class="w">      </span>MINIO_ROOT_PASSWORD:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_SECRET_KEY</span><span class="si">}</span>
<span class="w">      </span>MINIO_ACCESS_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_ACCESS_KEY</span><span class="si">}</span>
<span class="w">      </span>MINIO_SECRET_KEY:<span class="w"> </span><span class="si">${</span><span class="nv">MINIO_SECRET_KEY</span><span class="si">}</span>
<span class="w">      </span><span class="c1"># THIS DIFFERS FROM THE STANDARD ONE AND ENABLES LOCAL MINIO INSTEAD OF AWS S3 one </span>
<span class="w">    </span>command:<span class="w"> </span>server<span class="w"> </span>/data<span class="w"> </span>--console-address<span class="w"> </span><span class="s2">&quot;:9001&quot;</span>
networks:
<span class="w">  </span>host-net:
<span class="w">    </span>driver:<span class="w"> </span>bridge
<span class="w">  </span>esmero-net:
<span class="w">    </span>driver:<span class="w"> </span>bridge
<span class="w">    </span>internal:<span class="w"> </span><span class="nb">true</span>
</code></pre></div>
<p>Press CNTRL-X, and you are done.
Now the final test!!</p>
<h2 id="shutdown-the-old-one-start-the-new-one">Shutdown the old one, start the new one</h2>
<p>So we are ready. Testing may be a hit-or-miss thing here. Did we cover all the steps? Did a command fail? The good thing is that we can start the new ensemble, and all our old ones will survive. And we can come back over and over until we are ready. Let's try!</p>
<p>We will start by shutting down the running Docker ensemble:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/archipelago-deployment
docker-compose<span class="w"> </span>down
</code></pre></div>
<p>Now let's go to our new deployment. Docker starts here in a different folder:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/archipelago-deployment-live/deploy/ec2-docker
docker-compose<span class="w"> </span>up
</code></pre></div>
<p>You may notice that we removed the <code>-d</code>. Why? We want to see all the messages and notice/mark/copy any errors, e.g. did the SSL CERT load correctly? Did the MYSQL import work out?
To avoid shutting it down while all starts, please open another Terminal and type:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>ps
</code></pre></div>
<p>And look at the up-times. Do you see any Containers restarting (where Created and the Status differ for a lot and Status keeps resetting to 0?)? A healthy deployment will look similar to this:</p>
<div class="highlight"><pre><span></span><code>CONTAINER<span class="w"> </span>ID<span class="w">   </span>IMAGE<span class="w">                                    </span>COMMAND<span class="w">                  </span>CREATED<span class="w">          </span>STATUS<span class="w">         </span>PORTS<span class="w">                                      </span>NAMES
f794c25db64c<span class="w">   </span>esmero/cantaloupe-s3:4.1.9RC2-arm64<span class="w">      </span><span class="s2">&quot;sh -c &#39;java -Dcanta…&quot;</span><span class="w">   </span><span class="m">6</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">    </span>Up<span class="w"> </span><span class="m">3</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">0</span>.0.0.0:8183-&gt;8182/tcp<span class="w">                     </span>esmero-cantaloupe
5b791445720f<span class="w">   </span>jonasal/nginx-certbot<span class="w">                    </span><span class="s2">&quot;/docker-entrypoint.…&quot;</span><span class="w">   </span><span class="m">6</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">    </span>Up<span class="w"> </span><span class="m">3</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">0</span>.0.0.0:80-&gt;80/tcp,<span class="w"> </span><span class="m">0</span>.0.0.0:443-&gt;443/tcp<span class="w">   </span>esmero-web
e38fbbd86edf<span class="w">   </span>esmero/esmero-nlp:1.0.1-RC2-arm64<span class="w">        </span><span class="s2">&quot;/usr/local/bin/entr…&quot;</span><span class="w">   </span><span class="m">11</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">   </span>Up<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">0</span>.0.0.0:6400-&gt;6400/tcp<span class="w">                     </span>esmero-nlp
c84a0a4d43e9<span class="w">   </span>minio/minio:latest<span class="w">                       </span><span class="s2">&quot;/usr/bin/docker-ent…&quot;</span><span class="w">   </span><span class="m">11</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">   </span>Up<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">0</span>.0.0.0:9000-9001-&gt;9000-9001/tcp<span class="w">           </span>esmero-minio
3ec176a960c3<span class="w">   </span>esmero/php-7.4-fpm:1.0.0-RC2-multiarch<span class="w">   </span><span class="s2">&quot;docker-php-entrypoi…&quot;</span><span class="w">   </span><span class="m">11</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">   </span>Up<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">9000</span>/tcp<span class="w">                                   </span>esmero-php
e762ad7ea5e2<span class="w">   </span>solr:8.8.2<span class="w">                               </span><span class="s2">&quot;docker-entrypoint.s…&quot;</span><span class="w">   </span><span class="m">11</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">   </span>Up<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">0</span>.0.0.0:8983-&gt;8983/tcp<span class="w">                     </span>esmero-solr
381166d61f8c<span class="w">   </span>mariadb:10.5.10-focal<span class="w">                    </span><span class="s2">&quot;docker-entrypoint.s…&quot;</span><span class="w">   </span><span class="m">11</span><span class="w"> </span>seconds<span class="w"> </span>ago<span class="w">   </span>Up<span class="w"> </span><span class="m">6</span><span class="w"> </span>seconds<span class="w">   </span><span class="m">3306</span>/tcp<span class="w">      </span>
</code></pre></div>
<p>If you feel that all seems to be fine, open a browser window and visit your website. See if you can log in and see ADOs.
If not you can momentarily shut down this new Docker ensemble and restart the older one. Nothing is lost!
Then with time and tea/coffee and fresh eyes come back and re-trace your steps. 95% of the issues are incorrect values in the <code>.env</code> file. The other 5% may be on us.
If you run into any trouble please get in touch!</p>
<p>Happy deploying!</p>
<hr />
<p>Thank you for reading! Please contact us on our <a href="https://groups.google.com/forum/#!forum/archipelago-commons">Archipelago Commons Google Group</a> with any questions or feedback, or open an ISSUE in this <a href="https://github.com/esmero/archipelago-deployment-live/">Archipelago Deployment Live Repository</a>.</p>
<p>Return to <a href="../archipelago-deployment-live-readme/">Archipelago Live Deployment</a>.</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 24, 2022</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 24, 2022</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/esmero" target="_blank" rel="noopener" title="Archipelago Commons + esmero" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://groups.google.com/g/archipelago-commons" target="_blank" rel="noopener" title="Archipelago Commons Google Group" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 4v7H5.17L4 12.17V4zm1-2H3a1 1 0 0 0-1 1v14l4-4h10a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1m5 4h-2v9H6v2a1 1 0 0 0 1 1h11l4 4V7a1 1 0 0 0-1-1"/></svg>
    </a>
  
    
    
    
    
    <a href="https://archipelagocommons.slack.com" target="_blank" rel="noopener" title="Archipelago Commons Slack Channel" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.top", "navigation.sections", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "default", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>
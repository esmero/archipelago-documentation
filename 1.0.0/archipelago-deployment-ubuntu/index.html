
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Project documentation for Archipelago." name="description"/>
<meta content="The Digital Services Team at Metropolitan New York Library Council" name="author"/>
<link href="https://docs.archipelago.nyc/1.0.0/archipelago-deployment-ubuntu/" rel="canonical"/>
<link href="../archipelago-deployment-osx/" rel="prev"/>
<link href="../archipelago-deployment-windows/" rel="next"/>
<link href="../images/strawberries_color.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.15" name="generator"/>
<title>Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04 - Archipelago Documentation</title>
<link href="../assets/stylesheets/main.113286f1.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#installing-archipelago-drupal-9-on-ubuntu-1804-or-2004">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Archipelago Documentation" class="md-header__button md-logo" data-md-component="logo" href=".." title="Archipelago Documentation">
<img alt="logo" src="../images/strawberries_color.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Archipelago Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="" data-md-color-media="" data-md-color-primary="" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/esmero/archipelago-documentation" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    archipelago-documentation
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Archipelago Documentation" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Archipelago Documentation">
<img alt="logo" src="../images/strawberries_color.png"/>
</a>
    Archipelago Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/esmero/archipelago-documentation" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    archipelago-documentation
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          About Archipelago
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          About Archipelago
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../ourtake/">
        Archipelago's Philosophy &amp; Guiding Principles
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../strawberryfields/">
        Strawberryfields Forever
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../metadatainarchipelago/">
        Metadata in Archipelago
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archifilepersistencestrategy/">
        Archipelago's File Persistence Strategy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../devops/">
        Software Services
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CODE_OF_CONDUCT/">
        Code of Conduct
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Instructions and Guides
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Instructions and Guides
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          DevOps &amp; Deployment
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          DevOps &amp; Deployment
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
          Archipelago-Deployment
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_1_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
          Archipelago-Deployment
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-readme/">
        Start
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-osx/">
        Installing Archipelago Drupal 9 on OSX (macOS)
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#about-running-terminal-commands">
    About running terminal commands
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#wait-question-do-you-have-a-previous-version-of-archipelago-running">
    Wait! Question: Do you have a previous version of Archipelago running?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-deployment">
    Step 1: Deployment
  </a>
<nav aria-label="Step 1: Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prefer-to-watch-a-video-to-see-what-its-like-to-install-go-to-our-user-contributed-documentation1">
    Prefer to watch a video to see what it's like to install? Go to our user contributed documentation[^1]!
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#important">
    IMPORTANT
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-set-up-your-minio-s3-bucket">
    Step 2: Set up your Minio S3 bucket
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-deploy-drupal-9-and-the-awesome-archipelago-modules">
    Step 3: Deploy Drupal 9 and the awesome Archipelago Modules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-create-a-demo-and-a-jsonapi-user-using-drush-and-assign-your-admin-user-the-administrator-role-new-since-drupal-9">
    Step 4: Create a "demo "and a "jsonapi" user using drush and assign your "admin" user the Administrator Role (new since Drupal 9).
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-ingest-some-metadata-displays-to-make-playing-much-more-interactive">
    Step 5: Ingest some Metadata Displays to make playing much more interactive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-6-optional-but-more-fun-if-you-add-content">
    Step 6: Optional but more fun if you add content
  </a>
<nav aria-label="Step 6: Optional but more fun if you add content" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#need-help-blue-screen-missed-a-step-need-a-hug">
    Need help? Blue Screen? Missed a step? Need a hug?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#user-contributed-documentation-a-video1">
    User contributed documentation (A Video!)[^1]:
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#caring-coding-fixing-testing">
    Caring &amp; Coding + Fixing + Testing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#license">
    License
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-windows/">
        Installing Archipelago Drupal 9 on Windows 10/11
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-democontent/">
        Adding Demo Archipelago Digital Objects (ADOs) to your Repository
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-upgradeFromD8ToD9/">
        Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-upgradeFromRC3/">
        Upgrading from 1.0.0-RC3 to 1.0.0
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sslsetup/">
        How to Set Up SSL for Docker/Archipelago
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
          Archipelago-Deployment-Live
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
          Archipelago-Deployment-Live
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-readme/">
        Start
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-gitworkflow/">
        Github Workflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-moveToLive/">
        Moving from archipelago-deployment to archipelago-deployment-live
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-upgradeFromD8ToD9/">
        Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-upgradeFromRC3/">
        Upgrading from 1.0.0-RC3 to 1.0.0
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archipelago-deployment-live-updatingContainers/">
        Updating Docker Containers
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../utility_scripts/">
        Utility Scripts
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_1_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
          DevOps Q&amp;A
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_1_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_4">
<span class="md-nav__icon md-icon"></span>
          DevOps Q&amp;A
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../xdebug/">
        Debugging PHP in Archipelago
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../generalqa_minio_logging/">
        Min.io Logging
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../generalqa_smtp_configuration/">
        SMTP Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../generalqa_twig_modules_configuration/">
        Twig Modules Configuration
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Archipelago 101
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Archipelago 101
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../firstobject/">
        Ingesting Your First Object
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
          Webforms in Archipelago
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_2">
<span class="md-nav__icon md-icon"></span>
          Webforms in Archipelago
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../webforms/">
        Webforms
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../webformsasinput/">
        How to Create a Webform as an Input Method for Archipelago Digital Objects (ADO)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../modifyingfileextensionsinwebform/">
        Customizing Webforms (Modifying allowable file extensions)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../customwebformelements/">
        Archipelago Custom Webform Elements
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../metadata_display_preview/">
        Metadata Display Preview
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
          Twig Templates and Archipelago
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_4">
<span class="md-nav__icon md-icon"></span>
          Twig Templates and Archipelago
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../metadatatwigs/">
        Twig Templates and Archipelago
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../workingtwigs/">
        Working With Twig in Archipelago (getting started with custom Twig templates)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../twig_recipe_cards/">
        Twig Recipe Cards for Common Use Cases
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
          Archipelago Multi-Importer (AMI)
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_5">
<span class="md-nav__icon md-icon"></span>
          Archipelago Multi-Importer (AMI)
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../ami_index/">
        Archipelago Multi-Importer (AMI)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ami_spreadsheet_overview/">
        Spreadsheet Formatting Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../googleapi/">
        Configuration for Google Sheets API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AMIviaSpreadsheets/">
        Ingesting New Digital Objects and Collections using Spreadsheets or Google Sheets
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ami_lod_rec/">
        Linked Data Reconciliation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../I7solrImporter/">
        Using the Islandora 7 Solr Importer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../annotations/">
        Annotations
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_7" id="__nav_4_2_7_label" tabindex="0">
          Find and Replace
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_7_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_7">
<span class="md-nav__icon md-icon"></span>
          Find and Replace
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../find_and_replace/">
        Advanced Batch Find and Replace
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../find_and_replace_action_text/">
        Text Based Find and Replace
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../find_and_replace_action_webform/">
        Webform Find and Replace
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../find_and_replace_action_json_patch/">
        JSON Patch Find and Replace
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Site Administration &amp; Configuration
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Site Administration &amp; Configuration
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../strawberryfield-formatters/">
        Strawberryfield Formatters
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../createdisplaymodes/">
        Creating Display Modes
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../archifilepersistencestrategy/">
        Archipelago's File Persistence Strategy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../strawberry_key_name_providers/">
        Strawberry Key Name Providers
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          General Q&amp;A
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          General Q&amp;A
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../generalqa_index/">
        General Q&amp;A
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tbd/">
        Coming soon
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          Contributing
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../giveortake/">
        Archipelago Contribution Guide
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
          Documentation
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_5_2">
<span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../documentation_about/">
        About This Documentation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../documentation_template/">
        Documentation Template
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../documentation_features/">
        Additional Features
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../documentation_technical/">
        Technical Details
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Additional Resources
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Additional Resources
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../presentations_events/">
        Archipelago Presentations &amp; Events
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../inthewild/">
        Archipelagos in the Wild
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../acknowledgments/">
        Care &amp; Coding + Fixing / Acknowledgments / License
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#about-running-terminal-commands">
    About running terminal commands
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
    Prerequisites
  </a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#wait-question-do-you-have-a-previous-version-of-archipelago-running">
    Wait! Question: Do you have a previous version of Archipelago running?
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-deployment">
    Step 1: Deployment
  </a>
<nav aria-label="Step 1: Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prefer-to-watch-a-video-to-see-what-its-like-to-install-go-to-our-user-contributed-documentation1">
    Prefer to watch a video to see what it's like to install? Go to our user contributed documentation[^1]!
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#important">
    IMPORTANT
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-set-up-your-minio-s3-bucket">
    Step 2: Set up your Minio S3 bucket
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-deploy-drupal-9-and-the-awesome-archipelago-modules">
    Step 3: Deploy Drupal 9 and the awesome Archipelago Modules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-create-a-demo-and-a-jsonapi-user-using-drush-and-assign-your-admin-user-the-administrator-role-new-since-drupal-9">
    Step 4: Create a "demo "and a "jsonapi" user using drush and assign your "admin" user the Administrator Role (new since Drupal 9).
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-ingest-some-metadata-displays-to-make-playing-much-more-interactive">
    Step 5: Ingest some Metadata Displays to make playing much more interactive
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-6-optional-but-more-fun-if-you-add-content">
    Step 6: Optional but more fun if you add content
  </a>
<nav aria-label="Step 6: Optional but more fun if you add content" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#need-help-blue-screen-missed-a-step-need-a-hug">
    Need help? Blue Screen? Missed a step? Need a hug?
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#user-contributed-documentation-a-video1">
    User contributed documentation (A Video!)[^1]:
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#caring-coding-fixing-testing">
    Caring &amp; Coding + Fixing + Testing
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#license">
    License
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<nav class="md-tags">
<span class="md-tag">Archipelago-deployment</span>
<span class="md-tag">Drupal 9</span>
<span class="md-tag">Ubuntu 18.04</span>
<span class="md-tag">Ubuntu 20.04</span>
</nav>
<h1 id="installing-archipelago-drupal-9-on-ubuntu-1804-or-2004">Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04</h1>
<h2 id="about-running-terminal-commands">About running terminal commands</h2>
<p>This guide assumes you are comfortable enough running terminal (bash) commands on a Linux Computer.</p>
<p>We made sure that you can <code>copy</code> and <code>paste</code> each of these commands from this guide directly into your terminal.</p>
<p>You will notice sometimes commands <strong>span more than a single line</strong> of text. If that is the case, always make sure you copy and paste <strong>a single line at a time</strong> and press the <code>Enter</code> key afterwards. We suggest you also look at the output.</p>
<p>If something fails (and we hope it does not) troubleshooting will be much easier if you can share that output when asking for help.</p>
<p>Happy deploying!</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>At least 10 Gbytes of free space (to get started)</li>
<li>Some basic Unix/Terminal Skills</li>
<li>2-4 Gbytes of RAM (4 Recommended)</li>
<li>Install Docker if you don't have it already by running:</li>
</ul>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>software-properties-common
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span><span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt-cache<span class="w"> </span>policy<span class="w"> </span>docker-ce
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>docker-ce
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>docker

sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</code></pre></div>
<p>Log out, and log in again!</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>docker-compose
</code></pre></div>
<p>Git tools are included by default in Ubuntu.</p>
<h3 id="wait-question-do-you-have-a-previous-version-of-archipelago-running">Wait! Question: Do you have a previous version of Archipelago running?</h3>
<p>If so, let's give that hard working repository a break first. If not, <a href="#step-1-deployment">Step 1</a>:</p>
<ul>
<li>Open a terminal (you have that already right?) and go to your previous download/git clone folder and run:</li>
</ul>
<div class="highlight"><pre><span></span><code>docker-compose<span class="w"> </span>down
docker-compose<span class="w"> </span>rm
</code></pre></div>
<ul>
<li>Can't remember where you downloaded it? Ok. We can deal with that!</li>
</ul>
<p>Let's stop the containers gracefully first, run:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>stop<span class="w"> </span>esmero-web
docker<span class="w"> </span>stop<span class="w"> </span>esmero-solr
docker<span class="w"> </span>stop<span class="w"> </span>esmero-db
docker<span class="w"> </span>stop<span class="w"> </span>esmero-cantaloupe
docker<span class="w"> </span>stop<span class="w"> </span>esmero-php
docker<span class="w"> </span>stop<span class="w"> </span>esmero-minio
docker<span class="w"> </span>stop<span class="w"> </span>esmero-nlp
</code></pre></div>
<p>Now we need to remove them so we run the following:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>rm<span class="w"> </span>esmero-web
docker<span class="w"> </span>rm<span class="w"> </span>esmero-solr
docker<span class="w"> </span>rm<span class="w"> </span>esmero-db
docker<span class="w"> </span>rm<span class="w"> </span>esmero-cantaloupe
docker<span class="w"> </span>rm<span class="w"> </span>esmero-php
docker<span class="w"> </span>rm<span class="w"> </span>esmero-minio
docker<span class="w"> </span>rm<span class="w"> </span>esmero-nlp
</code></pre></div>
<p>Ok, now we are ready to start.</p>
<h2 id="step-1-deployment">Step 1: Deployment</h2>
<h5 id="prefer-to-watch-a-video-to-see-what-its-like-to-install-go-to-our-user-contributed-documentation1">Prefer to watch a video to see what it's like to install? Go to our <a href="#user-contributed-documentation-a-video1"><code>user contributed documentation</code></a>[^1]!</h5>
<h4 id="important">IMPORTANT</h4>
<p>If you run <code>docker-compose</code> as root user (using <code>sudo</code>) some enviromental variables, like the current folder used inside the <code>docker-compose.yml</code> to mount the Volumes, will not work and you will see a bunch of errors.</p>
<p>There are two possible solutions.</p>
<ul>
<li>The best is to add your <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04">user to the docker group</a> (so no <code>sudo</code> needed).</li>
<li>The second option is to replace every <code>{$PWD}</code> inside your <code>docker-compose.yml</code> with either the full path to your current folder, or with a <code>.</code> and wrap that whole line in double quotes, basically making the paths for volumes relatives.</li>
</ul>
<p>Instead of: <code>- ${PWD}:/var/www/html:cached</code>
use: <code>- ".:/var/www/html:cached"</code></p>
<p>Now that you got it, let's deploy:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/esmero/archipelago-deployment.git<span class="w"> </span>archipelago-deployment
<span class="nb">cd</span><span class="w"> </span>archipelago-deployment
git<span class="w"> </span>checkout<span class="w"> </span><span class="m">1</span>.0.0
</code></pre></div>
<p>And now a hard choice. Which docker-compose/ensemble? Edge? Stable? Legacy? So many choices. For latest/modern stack PHP8/Solr8.11/MySQL8 we recommend:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>docker-compose-linux.yml<span class="w"> </span>docker-compose.yml
docker-compose<span class="w"> </span>pull
docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>You have something running and do not want to update Databases/Solr indexes: Go legacy. In doubt? Ask us please. We can help.</p>
<p>If you want to stay more traditional (not recommended) and stick with older versions PHP7.4/Solr7.5/MySQL57 we recommend the following:</p>
<div class="highlight"><pre><span></span><code>cp<span class="w"> </span>docker-compose-legacy.yml<span class="w"> </span>docker-compose.yml
docker-compose<span class="w"> </span>pull
docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div>
<p>Note: <code>docker-compose.yml</code> is git ignored in case you make local adjustments or changes to it.</p>
<p>You need to make sure Docker can read/write to your local Drive, a.k.a mounted volumes (especially if you decided not to run it as <code>root</code> because we told you so!).</p>
<p>This means in practice running:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">8183</span>:8183<span class="w"> </span>persistent/iiifcache
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span><span class="m">8983</span>:8983<span class="w"> </span>persistent/solrcore
</code></pre></div>
<p>And then:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">"chown -R www-data:www-data private"</span>
</code></pre></div>
<p><em>Question:</em> Why is this last command different? Answer: Just a variation. The long answer is that the internal <code>www-data</code> user in that container (Alpine Linux) has uid:82, but on Ubuntu the <code>www-data</code> user has a different one so we let Docker assign the uid from inside instead. In practice you could also run directly <code>sudo chown -R 82:82 private</code> which would only apply to an Alpine use case, which can differ in the future! Does this make sense? No worries if not.</p>
<h2 id="step-2-set-up-your-minio-s3-bucket">Step 2: Set up your Minio S3 bucket</h2>
<p>Once all containers are up and running (you can do a <code>docker ps</code> to check),
access <code>http://localhost:9001</code> using your most loved Web Browser with the following credentials:</p>
<div class="highlight"><pre><span></span><code>user:minio
pass:minio123
</code></pre></div>
<p>and create a bucket named "archipelago". To do so go to the <code>Buckets</code> section in the navigation pane, and click <code>Create Bucket +</code>. Type <code>archipelago</code> under <code>Bucket Name</code> and submit, done! That is where we will persist all your Files and also your File copies of each Digital Object. You can always go there and explore what Archipelago (well really Strawberryfield does the hard work) has persisted so you can get comfortable with our architecture.</p>
<h2 id="step-3-deploy-drupal-9-and-the-awesome-archipelago-modules">Step 3: Deploy Drupal 9 and the awesome Archipelago Modules</h2>
<p>The following will run composer inside the esmero-php container to download all dependencies and Drupal Core too.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">"composer install"</span>
</code></pre></div>
<p>You will see a warning: <code>Do not run Composer as root/super user! See https://getcomposer.org/root for details</code> and the a long list of PHP packages. Don't worry. All is good here. Keep following the instructions! Once that command finishes run our setup script:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">'scripts/archipelago/setup.sh'</span>
</code></pre></div>
<p>Explanation: That script will append some important configurations to your local <code>web/sites/default/settings.php</code>.</p>
<p>Note: We say <code>local</code> because your whole Drupal web root (the one you cloned) is also mounted inside the esmero-php and esmero-web containers. So edits to PHP files, for example, can be done without accessing the container directly from your local folder.</p>
<p>If this is the first time you're deploying Drupal using the provided Configurations run:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>-u<span class="w"> </span>www-data<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">"cd web;../vendor/bin/drush -y si --verbose --existing-config --db-url=mysql://root:esmerodb@esmero-db/drupal --account-name=admin --account-pass=archipelago -r=/var/www/html/web --sites-subdir=default --notify=false;drush cr;chown -R www-data:www-data sites;"</span>
</code></pre></div>
<p>Note: You will see this warning: <code>[warning] The "block_content:1cdf7155-eb60-4f27-9e5e-64fffe93127a" was not found</code>. Nothing to worry about. We will provide the missing part in Step 5.</p>
<p>Note 2: Please be patient. This step takes now 25-30% longer because of how the most recent Drupal Installation code fetches translations and other resources (see <code>Performed install task</code>). This means progress might look like getting "stuck", go and get a coffee/tea and let it run to the end.</p>
<p>Once finished, this will give you an <code>admin</code> Drupal user with <code>archipelago</code> as password (change this if running on a public instance!) and also set the right Docker Container owner for your Drupal installation files.</p>
<p>Final note about Steps 2-3: You don't need to, nor should you do this more than once. You can destroy/stop/update, recreate your Docker containers, and start again (<code>git pull</code>), and your Drupal and Data will persist once you've passed the <code>Installation complete</code> message. I repeat, all other containers' data is persisted inside the <code>persistent/</code> folder contained in this cloned git repository. Drupal and all its code is visible, editable, and stable inside your <code>web/</code> folder.</p>
<h2 id="step-4-create-a-demo-and-a-jsonapi-user-using-drush-and-assign-your-admin-user-the-administrator-role-new-since-drupal-9">Step 4: Create a "demo "and a "jsonapi" user using drush and assign your "admin" user the Administrator Role (new since Drupal 9).</h2>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">'drush ucrt demo --password="demo"; drush urol metadata_pro "demo"'</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">'drush ucrt jsonapi --password="jsonapi"; drush urol metadata_api "jsonapi"'</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">'drush urol administrator "admin"'</span>
</code></pre></div></p>
<h2 id="step-5-ingest-some-metadata-displays-to-make-playing-much-more-interactive">Step 5: Ingest some Metadata Displays to make playing much more interactive</h2>
<p>Archipelago is more fun without having to start writing Metadata Displays (in Twig) before you know what they actually are. Since you should now have a <code>jsonapi</code> user and jsonapi should be enabled, you can use that awesome functionality of D8 to get that done. We have 4 demo Metadata Display Entities that go well with the demo Webform we provided. To do that execute in your shell (copy and paste):</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>esmero-php<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">'scripts/archipelago/deploy.sh'</span>
</code></pre></div>
<p>You are done! Open your most loved Web Browser and point it to <code>http://localhost:8001</code></p>
<p>Note: It can take some time to start the first time (Drupal needs some warming up). The Ubuntu deployment is WAY faster than the OSX deployment because of the way the bind mount volumes are handled by the driver. Our experience is that Archipelago basically reacts instantly!</p>
<h2 id="step-6-optional-but-more-fun-if-you-add-content">Step 6: Optional but more fun if you add content</h2>
<p><a href="../archipelago-deployment-democontent/">One-Step Demo content ingest</a></p>
<h3 id="need-help-blue-screen-missed-a-step-need-a-hug">Need help? Blue Screen? Missed a step? Need a hug?</h3>
<p>If you see any issues or errors or need help with a step, please let us know (ASAP!). You can either open an <code>issue</code> in this repository or use the <a href="https://groups.google.com/forum/#!forum/archipelago-commons">Google Group</a>. We are here to help.</p>
<p>If you like this, let us know!</p>
<h3 id="user-contributed-documentation-a-video1">User contributed documentation (A Video!)[^1]:</h3>
<p><em>Installing Archipelago on AWS Ubuntu</em> by <a href="https://github.com/senyzspalding">Zach Spalding</a>: <a href="https://youtu.be/RBy7UMxSmyQ">https://youtu.be/RBy7UMxSmyQ</a></p>
<p>[^1]: You may find this user contributed tutorial video, which was created for an earlier Archipelago release, to be helpful. Please note that there are significant differences between the executed steps and that you need to follow the current release instructions in order to have a successful deployment.</p>
<h2 id="caring-coding-fixing-testing">Caring &amp; Coding + Fixing + Testing</h2>
<ul>
<li><a href="https://github.com/DiegoPino">Diego Pino</a></li>
<li><a href="https://github.com/giancarlobi">Giancarlo Birello</a></li>
<li><a href="https://github.com/alliomeria">Allison Lund</a></li>
<li><a href="https://github.com/karomabiles">Katie Romabiles</a></li>
<li><a href="https://github.com/aksm">Albert Min</a></li>
</ul>
<h2 id="license">License</h2>
<p><a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a></p>
<hr/>
<div class="md-source-file">
<small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 18, 2022</span>
<br/>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 24, 2022</span>
</small>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" hidden="" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/esmero" rel="noopener" target="_blank" title="Archipelago Commons + esmero">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://groups.google.com/g/archipelago-commons" rel="noopener" target="_blank" title="Archipelago Commons Google Group">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M15 4v7H5.17L4 12.17V4h11m1-2H3a1 1 0 0 0-1 1v14l4-4h10a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1m5 4h-2v9H6v2a1 1 0 0 0 1 1h11l4 4V7a1 1 0 0 0-1-1Z"></path></svg>
</a>
<a class="md-social__link" href="https://archipelagocommons.slack.com" rel="noopener" target="_blank" title="Archipelago Commons Slack Channel">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.top", "navigation.sections", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "default", "provider": "mike"}}</script>
<script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>
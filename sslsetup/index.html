
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Project documentation for Archipelago.">
      
      
      
        <meta name="author" content="The Digital Services Team at Metropolitan New York Library Council">
      
      
        <link rel="canonical" href="https://docs.archipelago.nyc/sslsetup/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Sslsetup - Archipelago Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-setup-ssl-for-dockerarchipelago" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Archipelago Documentation" class="md-header__button md-logo" aria-label="Archipelago Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Archipelago Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sslsetup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Archipelago Documentation" class="md-nav__button md-logo" aria-label="Archipelago Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Archipelago Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Documentation Menu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CODE_OF_CONDUCT/" class="md-nav__link">
        Archipelago - code of conduct / anti-harassment policy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ami/" class="md-nav__link">
        Archipelago Multi-Importer (AMI)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../archifilepersistencestrategy/" class="md-nav__link">
        Archipelago's File Persistence Strategy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../createdisplaymodes/" class="md-nav__link">
        Creating Display Modes for Archipelago Digital Objects
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../customwebformelements/" class="md-nav__link">
        Archipelago Custom Webform Elements
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../devops/" class="md-nav__link">
        Archipelago Software Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../firstobject/" class="md-nav__link">
        Your First Digital Object
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../generalqa/" class="md-nav__link">
        General Q&A
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../giveortake/" class="md-nav__link">
        Archipelago Contribution Guide [![Google Groups](https://img.icons8.com/wired/32/000000/google-groups.png)](https://groups.google.com/forum/#!forum/archipelago-commons)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../googleapi/" class="md-nav__link">
        Configuration for Google Sheets API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../inthewild/" class="md-nav__link">
        Archipelago Community
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../metadatatwigs/" class="md-nav__link">
        Twig Templates and Archipelago
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modifyingfileextensionsinwebform/" class="md-nav__link">
        Customizing Webforms: Modifying allowable file extensions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ourtake/" class="md-nav__link">
        Archipelago's Philosophy & Guiding Principles
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Sslsetup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Sslsetup
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-setup-ssl-for-dockerarchipelago" class="md-nav__link">
    How to Setup SSL for Docker/Archipelago
  </a>
  
    <nav class="md-nav" aria-label="How to Setup SSL for Docker/Archipelago">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-configuration-steps-for-an-ec2-aws-server" class="md-nav__link">
    Manual Configuration Steps for an EC2 AWS Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-contributed-documentation" class="md-nav__link">
    User contributed documentation:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../strawberryfield-formatters/" class="md-nav__link">
        Strawberryfield Formatters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../strawberryfields/" class="md-nav__link">
        Strawberryfields Forever
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tbd/" class="md-nav__link">
        Documentation Update Needed
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../traditional-install/" class="md-nav__link">
        Traditional install
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../webforms/" class="md-nav__link">
        Webforms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../webformsasinput/" class="md-nav__link">
        Webforms as input method for Archipelago Digital Objects (ADO)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../workingtwigs/" class="md-nav__link">
        Working with Twig in Archipelago
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../xdebug/" class="md-nav__link">
        Debugging PHP in Archipelago
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-setup-ssl-for-dockerarchipelago" class="md-nav__link">
    How to Setup SSL for Docker/Archipelago
  </a>
  
    <nav class="md-nav" aria-label="How to Setup SSL for Docker/Archipelago">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-configuration-steps-for-an-ec2-aws-server" class="md-nav__link">
    Manual Configuration Steps for an EC2 AWS Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-contributed-documentation" class="md-nav__link">
    User contributed documentation:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Sslsetup</h1>
                
                <h2 id="how-to-setup-ssl-for-dockerarchipelago">How to Setup SSL for Docker/Archipelago</h2>
<p><em><em>Work-In-Progress Note</em> This documentation page is still under construction and content may change with future updates. Please use caution when implementing any instructions referenced herein, as there may be missing steps or corresponding configuration files. Thank you for your patience as we continue to update Archipelago's documentation.</em></p>
<p>The steps found below describe one potential manual SSL configuration for Archipelago deployments. A <code>git clone</code> deployment option will be available for future releases.</p>
<h3 id="manual-configuration-steps-for-an-ec2-aws-server">Manual Configuration Steps for an EC2 AWS Server</h3>
<p>This process takes less than 10 minutes of reading YML files and editing a few files (described below) to get SSL running and setup with auto-renewal.</p>
<ol>
<li>
<p>First, configure Certbot, following the instructions found on https://certbot.eff.org.</p>
</li>
<li>
<p>Inside a /persistent partition, establish the following folder structure.
<em>Note: you can keep the existing folder structure if you so choose. A benefit of the following structure is that it decouples the git clone of archipelago-deployment, which is made to be self sustainable and good for coding or smaller deployments.</em></p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="o">[</span>ec2-user@ip-17x-xx-x-xxx persistent<span class="o">]</span>$ ls -lah
total 64K
drwxr-xr-x <span class="m">14</span> root           root  <span class="m">4</span>.0K Oct  <span class="m">5</span> <span class="m">23</span>:11 .
dr-xr-xr-x <span class="m">19</span> root           root  <span class="m">275</span> Dec <span class="m">15</span>  <span class="m">2019</span> ..
drwxr-xr-x  <span class="m">8</span>       <span class="m">999</span>  <span class="m">999</span>   <span class="m">4096</span> Oct <span class="m">13</span> <span class="m">20</span>:07 db
drwxr-xr-x <span class="m">13</span> root           root  <span class="m">4</span>.0K Oct  <span class="m">5</span> <span class="m">23</span>:03 drupal8
drwxr-xr-x  <span class="m">5</span>           <span class="m">100</span>  <span class="m">100</span>   <span class="m">4</span>.0K Feb <span class="m">23</span>  <span class="m">2020</span> iiifcache
drwxr-xr-x  <span class="m">2</span> root           root  <span class="m">4</span>.0K Feb <span class="m">23</span>  <span class="m">2020</span> iiifconfig
drwxr-xr-x  <span class="m">4</span> root           root  <span class="m">4</span>.0K Oct  <span class="m">5</span> <span class="m">22</span>:45 nginx_conf
drwxr-xr-x  <span class="m">3</span> root           root  <span class="m">4</span>.0K Feb <span class="m">26</span>  <span class="m">2019</span> solrconfig
drwxr-xr-x  <span class="m">3</span>           <span class="m">8983</span> <span class="m">8983</span>  <span class="m">4</span>.0K Feb <span class="m">26</span>  <span class="m">2019</span> solrcore
</code></pre></div>
To get to this point, create a git clone of archipelago deployment and then copy the content of the /persistent out of the repo folder into this structure. The original (or what is left) archipelago-deployment ends inside a drupal8 folder here.</p>
<ol>
<li>Copy and paste the following to create a local copy of this file:</li>
</ol>
<details class="info"><summary>docker-compose.yml</summary><p>**Be sure to replace youremail@gmail.com with your email address.</p>
<div class="highlight"><pre><span></span><code> <span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.5&#39;</span>
 <span class="nt">services</span><span class="p">:</span>
   <span class="nt">web</span><span class="p">:</span>
     <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmero-web</span>
     <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">staticfloat/nginx-certbot</span>
     <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
     <span class="nt">environment</span><span class="p">:</span>
       <span class="nt">CERTBOT_EMAIL</span><span class="p">:</span> <span class="s">&quot;youremail@gmail.com&quot;</span>
     <span class="nt">ports</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="s">&quot;80:80&quot;</span>
       <span class="p p-Indicator">-</span> <span class="s">&quot;443:443&quot;</span>
     <span class="nt">volumes</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/nginx_conf/conf.d:/etc/nginx/user.conf.d:ro</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/nginx_conf/certbot_extra_domains:/etc/nginx/certbot/extra_domains:ro</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/drupal8:/var/www/html:cached</span>
     <span class="nt">depends_on</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">solr</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">php</span>
     <span class="nt">tty</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
     <span class="nt">networks</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host-net</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">esmero-net</span>
   <span class="nt">php</span><span class="p">:</span>
     <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmero-php</span>
     <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
     <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;esmero/php-7.3-fpm:latest&quot;</span>
     <span class="nt">tty</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
     <span class="nt">networks</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host-net</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">esmero-net</span>
     <span class="nt">volumes</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PWD}:/var/www/html:cached</span>
   <span class="nt">solr</span><span class="p">:</span>
     <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmero-solr</span>
     <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
     <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;solr:7.5.0&quot;</span>
     <span class="nt">tty</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
     <span class="nt">ports</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="s">&quot;8983:8983&quot;</span>
     <span class="nt">networks</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host-net</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">esmero-net</span>
     <span class="nt">volumes</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/solrcore:/opt/solr/server/solr/mycores:cached</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/solrconfig:/drupalconfig:cached</span>
     <span class="nt">entrypoint</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker-entrypoint.sh</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">solr-precreate</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">drupal</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/drupalconfig</span>
   <span class="c1"># see https://hub.docker.com/_/mysql/</span>
   <span class="nt">db</span><span class="p">:</span>
     <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:5.7</span>
     <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">--max_allowed_packet=256M</span>
     <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmero-db</span>
     <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
     <span class="nt">environment</span><span class="p">:</span>
       <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmerodb</span>
     <span class="nt">networks</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host-net</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">esmero-net</span>
     <span class="nt">volumes</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/db:/var/lib/mysql:cached</span>
   <span class="nt">iiif</span><span class="p">:</span>
     <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">esmero-cantaloupe</span>
     <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;esmero/cantaloupe-s3:4.1.6&quot;</span>
     <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
     <span class="nt">ports</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="s">&quot;8183:8182&quot;</span>
     <span class="nt">networks</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host-net</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">esmero-net</span>
     <span class="nt">volumes</span><span class="p">:</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/iiifconfig:/etc/cantaloupe</span>
       <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/persistent/iiifcache:/var/cache/cantaloupe</span>
 <span class="nt">networks</span><span class="p">:</span>
   <span class="nt">host-net</span><span class="p">:</span>
     <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bridge</span>
   <span class="nt">esmero-net</span><span class="p">:</span>
     <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bridge</span>
     <span class="nt">internal</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
</details>
<p><em>Note: This file shows how the folders in Step 1 are being used, and how SSL is being automatically deployed and renewed (without any human interaction other than starting the docker-compose and watching the logs).</em></p>
<ol>
<li>Now copy and paste the following to create a local copy of this file:</li>
</ol>
<details class="info"><summary>ngnix.conf</summary><p>**Be sure to replace all instances of yoursite.org with your own domain.</p>
<div class="highlight"><pre><span></span><code> <span class="c1"># goes into /persistent/nginx_conf/conf.d/nginx.conf</span>
 upstream cantaloupe <span class="o">{</span>
  server  esmero-cantaloupe:8182<span class="p">;</span>
  <span class="o">}</span>

  server <span class="o">{</span>
    listen              <span class="m">443</span> ssl<span class="p">;</span>
    server_name         yoursite.org<span class="p">;</span>
    ssl_certificate     /etc/letsencrypt/live/yourstie.org/fullchain.pem<span class="p">;</span>
    ssl_certificate_key /etc/letsencrypt/live/yoursite.org/privkey.pem<span class="p">;</span>

     client_max_body_size 512M<span class="p">;</span> <span class="c1">## Match with PHP from FPM container</span>

    root /var/www/html/web<span class="p">;</span> <span class="c1">## &lt;-- Your only path reference.</span>

    fastcgi_send_timeout 120s<span class="p">;</span>
    fastcgi_read_timeout 120s<span class="p">;</span>
    fastcgi_pass_request_headers on<span class="p">;</span>

    fastcgi_buffers <span class="m">16</span> 16k<span class="p">;</span>
    fastcgi_buffer_size 32k<span class="p">;</span>

    <span class="c1"># Cantaloupe proxypass</span>
    location /cantaloupe/ <span class="o">{</span>
       proxy_set_header X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>
       proxy_set_header X-Forwarded-Host <span class="nv">$host</span><span class="p">;</span>
       proxy_set_header X-Forwarded-Port <span class="nv">$server_port</span><span class="p">;</span>
       proxy_set_header X-Forwarded-Path /cantaloupe/<span class="p">;</span>
       proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
       <span class="k">if</span> <span class="o">(</span><span class="nv">$request_uri</span> ~* <span class="s2">&quot;/cantaloupe/(.*)&quot;</span><span class="o">)</span> <span class="o">{</span>
         proxy_pass http://cantaloupe/<span class="nv">$1</span><span class="p">;</span>
       <span class="o">}</span>
    <span class="o">}</span>

    <span class="nv">location</span> <span class="o">=</span> /favicon.ico <span class="o">{</span>
        log_not_found off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    <span class="nv">location</span> <span class="o">=</span> /robots.txt <span class="o">{</span>
        allow all<span class="p">;</span>
        log_not_found off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Very rarely should these ever be accessed outside of your lan</span>
    location ~* <span class="se">\.</span><span class="o">(</span>txt<span class="p">|</span>log<span class="o">)</span>$ <span class="o">{</span>
        deny all<span class="p">;</span>
    <span class="o">}</span>

    location ~ <span class="se">\.</span>.*/.*<span class="se">\.</span>php$ <span class="o">{</span>
        <span class="k">return</span> <span class="m">403</span><span class="p">;</span>
    <span class="o">}</span>

    location ~ ^/sites/.*/private/ <span class="o">{</span>
        <span class="k">return</span> <span class="m">403</span><span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Allow &quot;Well-Known URIs&quot; as per RFC 5785</span>
    location ~* ^/.well-known/ <span class="o">{</span>
        allow all<span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Block access to &quot;hidden&quot; files and directories whose names begin with a</span>
    <span class="c1"># period. This includes directories used by version control systems such</span>
    <span class="c1"># as Subversion or Git to store control files.</span>
    location ~ <span class="o">(</span>^<span class="p">|</span>/<span class="o">)</span><span class="se">\.</span> <span class="o">{</span>
        <span class="k">return</span> <span class="m">403</span><span class="p">;</span>
    <span class="o">}</span>

    location / <span class="o">{</span>
        try_files <span class="nv">$uri</span> /index.php?<span class="nv">$query_string</span><span class="p">;</span> <span class="c1"># For Drupal &gt;= 7</span>
    <span class="o">}</span>

    location @rewrite <span class="o">{</span>
        rewrite ^/<span class="o">(</span>.*<span class="o">)</span>$ /index.php?q<span class="o">=</span><span class="nv">$1</span><span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Don&#39;t allow direct access to PHP files in the vendor directory.</span>
    location ~ /vendor/.*<span class="se">\.</span>php$ <span class="o">{</span>
        deny all<span class="p">;</span>
        <span class="k">return</span> <span class="m">404</span><span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Allow Modules to be updated via UI (still we believe composer is the way)    </span>
    rewrite ^/core/authorize.php/core/authorize.php<span class="o">(</span>.*<span class="o">)</span>$ /core/authorize.php<span class="nv">$1</span><span class="p">;</span>

    <span class="c1"># In Drupal 8, we must also match new paths where the &#39;.php&#39; appears in</span>
    <span class="c1"># the middle, such as update.php/selection. The rule we use is strict,</span>
    <span class="c1"># and only allows this pattern with the update.php front controller.</span>
    <span class="c1"># This allows legacy path aliases in the form of</span>
    <span class="c1"># blog/index.php/legacy-path to continue to route to Drupal nodes. If</span>
    <span class="c1"># you do not have any paths like that, then you might prefer to use a</span>
    <span class="c1"># laxer rule, such as:</span>
    <span class="c1">#   location ~ \.php(/|$) {</span>
    <span class="c1"># The laxer rule will continue to work if Drupal uses this new URL</span>
    <span class="c1"># pattern with front controllers other than update.php in a future</span>
    <span class="c1"># release.</span>
    location ~ <span class="s1">&#39;\.php$|^/update.php&#39;</span> <span class="o">{</span>
        fastcgi_split_path_info ^<span class="o">(</span>.+?<span class="se">\.</span>php<span class="o">)(</span><span class="p">|</span>/.*<span class="o">)</span>$<span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
        <span class="c1"># Block httpoxy attacks. See https://httpoxy.org/.</span>
        fastcgi_param HTTP_PROXY <span class="s2">&quot;&quot;</span><span class="p">;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
        fastcgi_param PATH_INFO <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
        fastcgi_param PHP_VALUE <span class="s2">&quot;upload_max_filesize=512M \n post_max_size=512M&quot;</span><span class="p">;</span>
        proxy_read_timeout 900s<span class="p">;</span>
        fastcgi_intercept_errors on<span class="p">;</span>
        fastcgi_pass esmero-php:9000<span class="p">;</span>
    <span class="o">}</span>

     <span class="c1"># Fighting with Styles? This little gem is amazing.</span>
    location ~ ^/sites/.*/files/styles/ <span class="o">{</span> <span class="c1"># For Drupal &gt;= 7</span>
        try_files <span class="nv">$uri</span> @rewrite<span class="p">;</span>
    <span class="o">}</span>

    <span class="c1"># Handle private files through Drupal.</span>
    location ~ ^/system/files/ <span class="o">{</span> <span class="c1"># For Drupal &gt;= 7</span>
        try_files <span class="nv">$uri</span> /index.php?<span class="nv">$query_string</span><span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
</details>
<ol>
<li>Create the following folder:</li>
</ol>
<div class="highlight"><pre><span></span><code>/persistent/nginx_conf/conf.d/
</code></pre></div>
<ol>
<li>
<p>Place the ngnix.conf file inside the <code>/conf.d/</code> folder.</p>
</li>
<li>
<p>Create also this other folder:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>/persistent/nginx_conf/certbot_extra_domains/
</code></pre></div>
<ol>
<li>Inside the <code>/certbot_extra_domains/</code> folder, create a text file named the same way as your domain (which can/or not contain additional subdomains but needs to exist).</li>
</ol>
<div class="highlight"><pre><span></span><code>cat  /persistent/nginx_conf/certbot_extra_domains/yoursite.org
</code></pre></div>
<div class="highlight"><pre><span></span><code>drwxr-xr-x <span class="m">2</span> root root <span class="m">4</span>.0K Oct  <span class="m">5</span> <span class="m">22</span>:46 .
drwxr-xr-x <span class="m">4</span> root root <span class="m">4</span>.0K Oct  <span class="m">5</span> <span class="m">22</span>:45 ..
-rw-r--r-- <span class="m">1</span> root root   <span class="m">48</span> Oct  <span class="m">5</span> <span class="m">22</span>:46 yoursite.org
</code></pre></div>
<p><em>Optionally, create additional subdomains if needed.</em></p>
<div class="highlight"><pre><span></span><code>cat  /persistent/nginx_conf/certbot_extra_domains/yoursite.org
subdomain.yoursite.org
anothersub.yoursite.org
</code></pre></div>
<ol>
<li>
<p>Make sure you have edited the <code>docker-compose.yml</code> and <code>ngnix.conf</code> files you created to match your own information. Also make sure to also adjust the paths if you do not want the /persistent approach described in Step 1.</p>
</li>
<li>
<p>Run the following commands:</p>
</li>
</ol>
<p><div class="highlight"><pre><span></span><code>docker -compose up -d
docker ps
</code></pre></div>
You should see this:</p>
<div class="highlight"><pre><span></span><code>b5a04747ee06        staticfloat/nginx-certbot    <span class="s2">&quot;/bin/bash /scripts/…&quot;</span>   <span class="m">8</span> days ago          Up <span class="m">8</span> days           <span class="m">0</span>.0.0.0:80-&gt;80/tcp, <span class="m">0</span>.0.0.0:443-&gt;443/tcp   esmero-web
84afae094b57        esmero/php-7.3-fpm:latest    <span class="s2">&quot;docker-php-entrypoi…&quot;</span>   <span class="m">8</span> days ago          Up <span class="m">8</span> days           <span class="m">9000</span>/tcp                                   esmero-php
13a9214acfd0        esmero/cantaloupe-s3:4.1.6   <span class="s2">&quot;sh -c &#39;java -Dcanta…&quot;</span>   <span class="m">8</span> days ago          Up <span class="m">8</span> days           <span class="m">0</span>.0.0.0:8183-&gt;8182/tcp                     esmero-cantaloupe
044dd5bc7245        mysql:5.7                    <span class="s2">&quot;docker-entrypoint.s…&quot;</span>   <span class="m">8</span> days ago          Up <span class="m">8</span> days           <span class="m">3306</span>/tcp, <span class="m">33060</span>/tcp                        esmero-db
31f4f0f45acc        solr:7.5.0                   <span class="s2">&quot;docker-entrypoint.s…&quot;</span>   <span class="m">8</span> days ago          Up <span class="m">8</span> days           <span class="m">0</span>.0.0.0:8983-&gt;8983/tcp                     esmero-solr
</code></pre></div>
<p>10.SSL has now been configured for your Archipelago instance.</p>
<h3 id="user-contributed-documentation">User contributed documentation:</h3>
<p><em>Adding SSL to Archipelago running docker</em> by <a href="https://github.com/senyzspalding">Zachary Spalding</a>: https://youtu.be/rfH5TLzIRIQ</p>
<hr />
<p>Thank you for reading! Please contact us on our <a href="https://groups.google.com/forum/#!forum/archipelago-commons">Archipelago Commons Google Group</a> with any questions or feedback.</p>
<p>Return to the <a href="..">Archipelago Documentation main page</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ourtake/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Archipelago&#39;s Philosophy &amp; Guiding Principles" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Archipelago's Philosophy & Guiding Principles
            </div>
          </div>
        </a>
      
      
        
        <a href="../strawberryfield-formatters/" class="md-footer__link md-footer__link--next" aria-label="Next: Strawberryfield Formatters" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Strawberryfield Formatters
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>